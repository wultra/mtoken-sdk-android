name: Release a new version

on: 
  workflow_dispatch:
    inputs:
      version:
        description: 'Version of the library'
        required: true
      confirmBranch:
        description: 'Confirm release branch'
        required: true
      command:
        description: 'Library deploy command'
        required: false
        default: prepare push deploy -v2 --any-branch

jobs:
  publish:
    name: Publish
    runs-on: ubuntu-latest
    steps:
      - name: Checkout the repo
        uses: actions/checkout@v2
      - name: Make sure we're on the proper branch
        run: |
          [[ $GITHUB_REF == refs/heads/${{ github.event.inputs.confirmBranch }} ]] || exit 1
      - name: "Prepare bintray credentials"
        run: echo -e "bintray.user=${{ secrets.PUBLISH_BINTRAY_USER }}\nbintray.apiKey=${{ secrets.PUBLISH_BINTRAY_APIKEY }}\nbintray.userOrg=${{ secrets.PUBLISH_BINTRAY_USERORG }}" > local.properties
      - name: Publish the library
        uses: kober32/library-deploy@develop
        with:
          script-parameters: ${{ github.event.inputs.version }} ${{ github.event.inputs.command }}